_target_: src.datamodules.voxceleb_datamodule.VoxCelebDataModule

dataset:
  data_dir: ${paths.data_dir}/voxceleb
  wav_dir: ${datamodule.dataset.data_dir}/voxceleb1_2
  veri_test_filenames: 
    - veri_test2
    - veri_test_extended2
    - veri_test_hard2
  voxceleb_metadata: ${datamodule.dataset.data_dir}/voxceleb_metadata
  base_search_dir: ${datamodule.dataset.voxceleb_metadata}/metadata

  voxceleb_artifacts_dir: ${hydra:runtime.output_dir}/voxceleb_artifacts
  veri_test_output_paths:
    veri_test2: ${datamodule.dataset.voxceleb_artifacts_dir}/veri_test2.csv
    veri_test_extended2: ${datamodule.dataset.voxceleb_artifacts_dir}/veri_test_extended2.csv
    veri_test_hard2: ${datamodule.dataset.voxceleb_artifacts_dir}/veri_test_hard2.csv
  metadata_csv_file: ${datamodule.dataset.voxceleb_artifacts_dir}/vox_meta.csv
  train_csv_file: ${datamodule.dataset.voxceleb_artifacts_dir}/train.csv
  val_csv_file: ${datamodule.dataset.voxceleb_artifacts_dir}/val.csv
  speaker_lookup: ${datamodule.dataset.voxceleb_artifacts_dir}/speaker_lookup.csv

  seed: ${seed}
  sep: "|"
  verbose: true
  save_csv: true
  sample_rate: 16000

  min_duration: 0.5
  speaker_overlap: True
  train_ratio: 0.95

  # --- Segmentation Strategy ---
  # - true: Generate segments with fixed boundaries in CSV (deterministic, full coverage)
  # - false: Store full file metadata, apply random cropping during training (augmentation)
  use_pre_segmentation: true
  
  # Segmentation parameters (only used if use_pre_segmentation=true)
  segment_duration: 3.0  # Duration of each segment in seconds
  segment_overlap: 0.0  # Overlap between segments in seconds (0.0 = non-overlapping)
  min_segment_duration: 0.5  # Minimum segment duration to be included
  
  # Random cropping parameter (only used if use_pre_segmentation=false)
  max_duration: 3.0  # Maximum duration for random cropping during training

  # --- Optional VAD (applied at CSV level, before segmentation) ---
  vad:
    _target_: src.datamodules.preparation.vad.SileroCsvVad
    enabled: false  # Master switch; when true, VAD rewrites rows via vad_start/vad_end
    apply_to_splits: [dev]  # VoxCeleb prep produces a dev metadata table (later split into train/val)

    # Model input/sample rate (should match your audio + pipeline expectations)
    sample_rate: ${datamodule.dataset.sample_rate}

    # Silero VAD detection knobs
    min_speech_duration_ms: 250  # Drop detected speech bursts shorter than this (in ms)
    min_silence_duration_ms: 100  # Silence shorter than this will not split speech segments (in ms)
    speech_pad_ms: 30  # Expand speech segments a bit on both ends (in ms)

    # Post-processing to reduce VAD glitches
    merge_gap_s: 0.10  # Merge adjacent speech segments separated by <= this gap (seconds)
    drop_short_speech_s: 0.20  # Drop post-merged speech segments shorter than this (seconds)

    # Split a file into multiple rows if there is a long internal silence.
    # Threshold is dynamic: clamp(duration * ratio, min_s, max_s)
    long_silence_ratio: 0.20
    long_silence_min_s: 0.60
    long_silence_max_s: 2.00

    # Segment-level skipping (only relevant when you also pre-segment):
    # a segment is dropped if silence_ratio > segment_max_silence_ratio.
    segment_max_silence_ratio: 0.80

transforms: null

num_classes: 7205

loaders:
  train:
    batch_size: 32
    shuffle: True
    num_workers: 4
    drop_last: True
    pin_memory: False

  valid:
    batch_size: 32
    shuffle: False
    num_workers: 4
    drop_last: False
    pin_memory: False

  test:
    batch_size: 8
    shuffle: False
    num_workers: 4
    drop_last: False
    pin_memory: False

  enrollment:
    batch_size: 8
    shuffle: False
    num_workers: 4
    drop_last: False
    pin_memory: False
